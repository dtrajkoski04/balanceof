<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>FST Balance (Holesky)</title>

  <!-- ethers.js UMD build -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.11.1/dist/ethers.umd.min.js"></script>

  <style>
    body   { font-family: system-ui, sans-serif; text-align:center; margin:3rem auto; max-width:34rem; }
    button { padding:.7rem 1.5rem; font-size:1rem; cursor:pointer; margin-top:1.2rem; }
    #out   { margin-top:1.5rem; font-size:1.2rem; font-weight:600; }
  </style>
</head>
<body>
  <h1>ERC-20 Balance Checker</h1>

  <button id="btn">Connect wallet</button>
  <div id="out">—</div>

  <script>
    /* ▶ Your token contract on Holesky */
    const tokenAddress = "0x7AC4Db5E629e78896C011fD75818615Ff30e1211";

    /* Minimal ABI: balanceOf, decimals, symbol */
    const erc20Abi = [
      "function balanceOf(address) view returns (uint256)",
      "function decimals() view returns (uint8)",
      "function symbol()   view returns (string)"
    ];

    const btn  = document.getElementById("btn");
    const out  = document.getElementById("out");
    let provider, signer, contract;

    async function connect() {
      if (!window.ethereum) {
        alert("MetaMask (or another injected wallet) is required.");
        return;
      }
      await window.ethereum.request({ method: "eth_requestAccounts" });

      provider = new ethers.BrowserProvider(window.ethereum);
      signer   = await provider.getSigner();

      /* Ensure Holesky network */
      const { chainId } = await provider.getNetwork();
      if (Number(chainId) !== 17000) {
        alert("Please switch MetaMask to the Holesky testnet (chain-ID 17000) and reload.");
        return;
      }

      contract = new ethers.Contract(tokenAddress, erc20Abi, provider);
      btn.textContent = "Show balance";
    }

    async function showBalance() {
      try {
        if (!contract) await connect();

        const addr = await signer.getAddress();               // dynamic MetaMask account
        const [rawBal, decimals, symbol] = await Promise.all([
          contract.balanceOf(addr),
          contract.decimals(),
          contract.symbol()
        ]);

        const human = ethers.formatUnits(rawBal, decimals);
        out.textContent = `Balance: ${human} ${symbol}`;
      } catch (err) {
        console.error(err);
        out.textContent = "Error: " + (err.message ?? err);
      }
    }

    btn.addEventListener("click", () => {
      btn.textContent === "Connect wallet" ? connect() : showBalance();
    });

    /* Auto-connect if the site was authorised earlier */
    if (window.ethereum && window.ethereum.selectedAddress) {
      connect();
    }

    /* React to account switches without reload */
    if (window.ethereum) {
      window.ethereum.on("accountsChanged", () => {
        out.textContent = "—";
        btn.textContent = "Show balance";
        contract = null;   // force reconnect on next click
      });
    }
  </script>
</body>
</html>
